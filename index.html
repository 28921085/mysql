<!DOCTYPE html>
<html>
   <head>
      
      <meta http-equiv='Content-type' content='text/html'; charset='utf-8'>
        <meta http-equiv="Pragma" Content="No-cache">
      <style type="text/css">
        *{
                box-sizing: border-box;
                font-family: Perpetua;
            }
            body{          background-color:#EEFFEE
            
            }
            nav             { font-weight: bold;
                           color: white;
                           border: 2px solid RoyalBlue;
                           text-align: center;
                           width: 25%;
                           background-color: RoyalBlue;
                            float:left;}
            nav:hover{
                background-color: gold;
                color: black;
            }
            nav ul          { display: none;
                            list-style: none;
                            text-align: center;
                            border: 2px solid RoyalBlue;
                            width:25%;
                            margin: 0;
                            padding:0;
                            position: absolute;}
            nav:hover ul    { display: block; }
            nav ul li       { border-top: 2px solid royalblue;
                            background-color: white;
                           
                            color: black; }
            nav ul li:hover { background-color: PowderBlue; 
                              color:firebrick;
                              font-weight: bold;  
                            }
            a{
                text-decoration: none;
            }
            div table{
                border: 1px solid;
                padding: 10;
                font-size: 36px;
                text-shadow: -4px 4px 6px dimgray;
            }
            div table tr td{
                border: 1px solid;
                width: 10%;
            }
            @media screen and (max-width:650px){
                nav{
                    float:initial;
                }
                ul{
                    width:100%;
                    position: relative;
                }
                input[type=text]{
                    width:30px;
                }
            }
            @media screen and (max-width:1200px){
                input[type=text]{
                    width:50px;
                }
                table td{
                    font-size: 16px;
                }
            }
        </style>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
        <script>
            let type;
            function reset(){
                $("#display").html("")
            }
            function showData(dat){
                let data;
                if(type=="getGraphRecord"){
                    data=[["ID","name","classify","2D3D"]];
                    for(let i=0;i<dat.length;i++){
                        let tmp=[];
                        tmp.push(dat[i]['ID'])
                        tmp.push(dat[i]['name'])
                        tmp.push(dat[i]['classify'])
                        tmp.push(dat[i]['2D3D'])
                        data.push(tmp)
                    }
                }
                else if(type=="getFormula"){
                    data=[["name","request","domain_min","domain_max"]];
                    for(let i=0;i<dat.length;i++){
                        let tmp=[];
                        tmp.push(dat[i]['name'])
                        tmp.push(dat[i]['request'])
                        tmp.push(dat[i]['domain_min'])
                        tmp.push(dat[i]['domain_max'])
                        data.push(tmp)
                    }
                }
                else if(type=="getClassifyDetail"){
                    data=[["name","X","Y","Z","request1","request2","request3","detailLink"]]
                    for(let i=0;i<dat.length;i++){
                        let tmp=[];
                        tmp.push(dat[i]['name'])
                        tmp.push(dat[i]['X'])
                        tmp.push(dat[i]['Y'])
                        tmp.push(dat[i]['Z'])
                        tmp.push(dat[i]['request1'])
                        tmp.push(dat[i]['request2'])
                        tmp.push(dat[i]['request3'])
                        tmp.push(dat[i]['detailLink'])
                        data.push(tmp)
                    }
                }
                let $table=$(document.createElement('table'));
                for(let i=0;i<data.length;i++){
                    let $tr=$(document.createElement('tr'));
                    for(let j=0;j<data[i].length;j++){
                        let $td=$(document.createElement('td'));
                        $td.text(data[i][j]);
                        $tr.append($td);
                    }
                    $table.append($tr)
                }
                $("#display").append($table)
            }
            function get_from_mysql(str){
                const limit = {"limit":5};
                const dbParam = JSON.stringify(limit);
                let data;
                xmlhttp = new XMLHttpRequest();
                xmlhttp.open("GET",str+".php?x=" + dbParam);
                xmlhttp.send();
                type=str
                xmlhttp.onload = function() {
                    data=JSON.parse(unescape(this.responseText));
                    showData(data);
                }
            }
            function getGraph(){
                reset()
                get_from_mysql("getGraphRecord");
            }
            function getFormula(){
                let data=[["name","request","domain_min","domain_max"]];
                reset()
                get_from_mysql("getFormula");
            }
            function getDetail(){
                let data=[["name","X","Y","Z","request1","request2","request3","detailLink"]];
                reset()
                get_from_mysql("getClassifyDetail");
            }
            /*function getAll(){  有bug
                getGraph()
                $("#display").append($(document.createElement('hr')))
                getDetail()
                $("#display").append($(document.createElement('hr')))
                getFormula()
            }*/
            function modify(ID){
                console.log(ID)
                //todo modify data
                //decode ex:ID=102 mean 1 row 2 col
            }
            function showInput(data){
                let $table=$(document.createElement('table'));
                for(let i=0;i<data.length;i++){
                    let $tr=$(document.createElement('tr'));
                    if(i){
                        let $td=$(document.createElement('td'))
                        $('<input>').attr({
                            type:'button',
                            id:i.toString(),
                            value:'刪除此橫行'
                        }).appendTo($td);
                        $tr.append($td);
                    }
                    else{
                        let $td=$(document.createElement('td'))
                        $tr.append($td)
                    }
                    for(let j=0;j<data[i].length;j++){
                        let $td=$(document.createElement('td'));
                        if(i){
                            let ID=i*100+j;
                            $('<input>').attr({
                                type:'text',
                                id:ID.toString()
                            }).appendTo($td);
                            $('<input>').attr({
                                type:'button',
                                value:'修改',
                                onclick:'modify('+ID.toString()+')'
                            }).appendTo($td);
                            $('<span>'+data[i][j]+'</span>').appendTo($td);
                        }
                        else
                            $td.text(data[i][j]);
                        $tr.append($td);
                    }
                    $table.append($tr)
                }
                let $tr=$(document.createElement('tr'));
                for(let i=0;i<=data[0].length;i++){
                    let $td=$(document.createElement('td'));
                    if(i){
                        $('<input>').attr({
                                type:'text',
                                id:i.toString()
                            }).appendTo($td);
                    }
                    else{
                        $('<input>').attr({
                            type:'button',
                            id:i.toString(),
                            value:'新增此橫行'
                        }).appendTo($td);
                    }
                    $tr.append($td);
                }
                $table.append($tr);
                $("#display").append($table)
            }
            function modifyGraph(){
                reset()
                let data=[["ID","name","classify","2D3D"],["1","2","3","4"]];
                //TODO data = get from database 以上為暫定data
                showInput(data);
            }
            function modifyDetail(){
                reset()
                let data=[["name","X","Y","Z","request1","request2","request3","detailLink"],["1","2","3","4","30678","87","666","7777"]];
                //TODO data = get from database 以上為暫定data
                showInput(data);
            }
            function modifyFormula(){
                reset()
                let data=[["ID","name","classify","2D3D"],["1","2","3","4"]];
                //TODO data = get from database 以上為暫定data
                showInput(data);
            }
        </script>
   </head>
   <body >
    <nav>
        查詢當前表格
        <ul>
            <!--li onclick="getAll()">顯示全部</li-->
            <li onclick="getGraph()">GraphRecord</li>
            <li onclick="getDetail()">ClassifyDetail</li>
            <li onclick="getFormula()">Formula</li>
        </ul>
    </nav>
    <nav>
        搜尋圖形定義
    </nav>
    <nav>
        修改資料
        <ul>
            <li onclick="modifyGraph()">GraphRecord</li>
            <li onclick="modifyDetail()">ClassifyDetail</li>
            <li onclick="modifyFormula()">Formula</li>
         </ul>
    </nav>
    <nav>
        參考資料
        <ul>
            <li><a href="https://zh.wikipedia.org/wiki/%E5%B9%BE%E4%BD%95%E5%9C%96%E5%BD%A2">幾何圖形</a></li>
            <li><a href="https://www.cnblogs.com/Anita9002/p/4380146.html">OpenGL</a></li>
            
         </ul>
    </nav>
    <hr>
    <div id="display"></div>
    <div id="1"></div>
   </body>
</html>
